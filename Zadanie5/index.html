<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
	<fieldset id="addForm">
    <legend>Add New User</legend>
		<label for="ID">ID: </label> <input id="add_id" type="text" placeholder="01" pattern="[0-9]{1-6}"><br><br>
		<label for="imie">Imie: </label> <input id="add_name" type="text" placeholder="Jan" pattern="[a-zA-Z]{2,64}">
		<label for="nazwisko">Nazwisko: </label> <input id="add_surname" type="text" placeholder="Kowalski" pattern="[a-zA-Z]{2,64}"><br><br>
		<label for="dowod">Nr. dowodu: </label> <input id="add_personal ID number" type="text" placeholder="XTR123456" pattern="[A-Z]{3}[0-9]{6}"><br><br>
		<label for="email">Email: </label> <input id="add_email" type="text" placeholder="email@wp.pl" pattern="[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$"><br><br>
		<label for="tel">Nr. Tel: </label> <input id="add_tel" type="text" placeholder="570-123-421" pattern="[0-9]{3}(-)?[0-9]{3}(-)?[0-9]{3}"><br><br>
		<button onclick="addEmployee()">Add</button>
    </fieldset>

    <table border=1>
        <thead>
            <th style="width:2em">ID</th>
            <th style="width:6em">Imie</th>
            <th style="width:6em">Nazwisko</th>
            <th style="width:14em">Email</th>
			<th style="width:2em">Tel</th>
        </thead>
    </table>
	</br>
	
	<button onclick="deleteEmployee()">Delete User</button>
    <input id="delete_id" type="text" placeholder="ID">
	
	 <script>
		window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
		window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
		window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange

		if (!window.indexedDB) {
			window.alert("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.")
		};

		const employeeData = [{id:"01", name:"Karol", surname:"Nowak", email:"example@wp.pl", tel:"123-123-123"}];

		var db;
		var request = window.indexedDB.open("newDatabase", 1);

		request.onerror = function (event) {
			console.log("error: ");
		};

		request.onsuccess = function (event) {
			db = request.result;
			console.log("success: ", db);
			loadTable();
		};

		request.onupgradeneeded = function (event) {
			var db = event.target.result;
			var objectStore = db.createObjectStore("employee", {keyPath: "id"});

			for (var i in employeeData) {
				objectStore.add(employeeData[i]);
			}
		}

		function loadTable() {
			var employees = "";
			$('.employee').remove();

			var objectStore = db.transaction("employee").objectStore("employee");
			objectStore.openCursor().onsuccess = function (event) {
				var cursor = event.target.result;
				if (cursor) {
					employees = employees.concat(
						'<tr class="employee">' +
						'<td class="ID">' + cursor.key + '</td>' +
						'<td class="Imie">' + cursor.value.name + '</td>' +
						'<td class="Nazwisko">' + cursor.value.surname + '</td>' +
						'<td class="Email">' + cursor.value.email + '</td>' +
						'<td class="Tel">' + cursor.value.tel + '</td>' +
						'</tr>');
					cursor.continue(); // wait for next event
				} else {
					$('thead').after(employees); // no more events
				}
			};
		}

		function addEmployee() {
			var employeeID = $('#add_id').val();
			var name = $('#add_name').val();
			var surname = $('#add_surname').val();
			var email = $('#add_email').val();
			var tel = $('#add_tel').val();
			var request = db.transaction(["employee"], "readwrite").objectStore("employee").add({
					id: employeeID,
					name: name,
					surname: surname,
					email: email,
					tel: tel,
				});


			request.onsuccess = function (event) {
				loadTable();
				clearButtons();
			};

			request.onerror = function (event) {
				alert("error");
			}
		}

		function deleteEmployee() {
			var employeeID = $('#delete_id').val();
			var request = db.transaction(["employee"], "readwrite").objectStore("employee").delete(employeeID);

			request.onsuccess = function (event) {
				loadTable();
				clearButtons();
			};
		};

		function clearButtons() {
			$('#add_id').val("");
			$('#add_name').val("");
			$('#add_surname').val("");
			$('#add_email').val("");
			$('#add_tel').val("");
		};
    </script>
</body>
</html>




